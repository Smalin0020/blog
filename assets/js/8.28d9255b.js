(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{446:function(s,t,a){s.exports=a.p+"assets/img/webhooks2.80a01886.jpg"},485:function(s,t,a){s.exports=a.p+"assets/img/jenkins1.2006a161.png"},486:function(s,t,a){s.exports=a.p+"assets/img/jenkins2.9c24beca.png"},487:function(s,t,a){s.exports=a.p+"assets/img/jenkins3.64e2ecaf.png"},488:function(s,t,a){s.exports=a.p+"assets/img/jenkins4.23f41449.png"},489:function(s,t,a){s.exports=a.p+"assets/img/jenkins5.3cbb3df4.png"},490:function(s,t,a){s.exports=a.p+"assets/img/config0.799e74f3.png"},491:function(s,t,a){s.exports=a.p+"assets/img/config2.0db7d273.png"},492:function(s,t,a){s.exports=a.p+"assets/img/config1.5dcdf675.png"},493:function(s,t,a){s.exports=a.p+"assets/img/config4.93401013.png"},494:function(s,t,a){s.exports=a.p+"assets/img/config3.0bcc28c0.png"},495:function(s,t,a){s.exports=a.p+"assets/img/config5.3a28e24e.png"},496:function(s,t,a){s.exports=a.p+"assets/img/config6.bc8380d0.png"},497:function(s,t,a){s.exports=a.p+"assets/img/item1.d3074b06.png"},498:function(s,t,a){s.exports=a.p+"assets/img/item2.b0e394fe.png"},499:function(s,t,a){s.exports=a.p+"assets/img/item3.86783d6a.png"},500:function(s,t,a){s.exports=a.p+"assets/img/item4.13b4f9b5.png"},501:function(s,t,a){s.exports=a.p+"assets/img/webhooks1.c82bd2b8.jpg"},577:function(s,t,a){"use strict";a.r(t);var e=a(4),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"gitee-webhooks-jenkins-实现自动化部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gitee-webhooks-jenkins-实现自动化部署"}},[s._v("#")]),s._v(" gitee + webhooks + jenkins 实现自动化部署")]),s._v(" "),e("p",[s._v("作为一名前端开发扫地僧，得折腾。通过 "),e("code",[s._v("push")]),s._v(" "),e("code",[s._v("pull request")]),s._v(" 等操作，直接自动化部署到服务器，之后再发送邮件，这样的逼格岂不是提升了些许。。")]),s._v(" "),e("h2",{attrs:{id:"自动部署大致原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自动部署大致原理"}},[s._v("#")]),s._v(" 自动部署大致原理")]),s._v(" "),e("ul",[e("li",[s._v("通过 "),e("code",[s._v("push")]),s._v(" 推送代码")]),s._v(" "),e("li",[e("code",[s._v("webhooks")]),s._v(" 自动发送请求到 "),e("code",[s._v("jenkins")])]),s._v(" "),e("li",[e("code",[s._v("jenkins")]),s._v(" 接受到请求后，开始自动构建")]),s._v(" "),e("li",[e("code",[s._v("jenkins")]),s._v(" 构建完成后执行"),e("code",[s._v("shell")]),s._v("脚本来自动部署 => 自动触发邮件")]),s._v(" "),e("li",[s._v("实现代码自动化部署与自动发送邮件")])]),s._v(" "),e("h2",{attrs:{id:"首先确保服务器有-java-环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#首先确保服务器有-java-环境"}},[s._v("#")]),s._v(" 首先确保服务器有 "),e("code",[s._v("java")]),s._v(" 环境")]),s._v(" "),e("ol",[e("li",[s._v("安装 "),e("code",[s._v("jdk")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openjdk-8-jdk\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("查看是否安装成功")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ java -version\n")])])]),e("h2",{attrs:{id:"安装-jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-jenkins"}},[s._v("#")]),s._v(" 安装 "),e("code",[s._v("jenkins")])]),s._v(" "),e("ol",[e("li",[s._v("安装 "),e("code",[s._v("jenkins")])])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -q -O - https://pkg.jenkins.io/debian/jenkins-ci.org.key "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'echo deb http://pkg.jenkins.io/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" jenkins\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[e("code",[s._v("jenkins")]),s._v(" 配置文件")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/init.d/jenkins\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[e("code",[s._v("jenkins")]),s._v(" 工作目录")])]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 工作区目录")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/jenkins\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/log/jenkins/jenkins.log\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置文件 1 端口配置")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/default/jenkins\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置文件 2 ")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/init.d/jenkins\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启配置")]),s._v("\n$ systemctl daemon-reload\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("配置 "),e("code",[s._v("jenkins")])])]),s._v(" "),e("p",[s._v("验证密码")]),s._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务器密码位置")]),s._v("\n/var/lib/jenkins/secrets/initialAdminPassword\n")])])]),e("p",[e("img",{attrs:{src:a(485),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"默认选择第一个，如果你有特殊需求的话，请随意"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#默认选择第一个，如果你有特殊需求的话，请随意"}},[s._v("#")]),s._v(" 默认选择第一个，如果你有特殊需求的话，请随意")]),s._v(" "),e("p",[e("img",{attrs:{src:a(486),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"添加一个管理员账户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加一个管理员账户"}},[s._v("#")]),s._v(" 添加一个管理员账户")]),s._v(" "),e("p",[e("img",{attrs:{src:a(487),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"一路点下去"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一路点下去"}},[s._v("#")]),s._v(" 一路点下去")]),s._v(" "),e("p",[e("img",{attrs:{src:a(488),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"好吧，看来你已经成功了！"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#好吧，看来你已经成功了！"}},[s._v("#")]),s._v(" 好吧，看来你已经成功了！")]),s._v(" "),e("p",[e("img",{attrs:{src:a(489),alt:"Jenkins"}})]),s._v(" "),e("h2",{attrs:{id:"安装-jenkins-插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-jenkins-插件"}},[s._v("#")]),s._v(" 安装 "),e("code",[s._v("jenkins")]),s._v(" 插件")]),s._v(" "),e("h3",{attrs:{id:"选择-系统管理-插件管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#选择-系统管理-插件管理"}},[s._v("#")]),s._v(" 选择 "),e("code",[s._v("系统管理")]),s._v(" "),e("code",[s._v("插件管理")])]),s._v(" "),e("p",[e("img",{attrs:{src:a(490),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"在可选插件里面搜索-gitee-然后点击直接安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在可选插件里面搜索-gitee-然后点击直接安装"}},[s._v("#")]),s._v(" 在"),e("code",[s._v("可选插件")]),s._v("里面搜索 "),e("code",[s._v("gitee")]),s._v(" 然后点击直接安装")]),s._v(" "),e("p",[e("img",{attrs:{src:a(491),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"在继续搜索插件-email-extension-template-plugin"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在继续搜索插件-email-extension-template-plugin"}},[s._v("#")]),s._v(" 在继续搜索插件 "),e("code",[s._v("Email Extension Template Plugin")])]),s._v(" "),e("p",[s._v("继续安装，在之后配置自动发送邮件时需要使用")]),s._v(" "),e("h2",{attrs:{id:"全局配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局配置"}},[s._v("#")]),s._v(" 全局配置")]),s._v(" "),e("h3",{attrs:{id:"选择系统管理-系统设置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#选择系统管理-系统设置"}},[s._v("#")]),s._v(" 选择系统管理=>系统设置")]),s._v(" "),e("p",[e("img",{attrs:{src:a(492),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"选择-gitee-进行配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#选择-gitee-进行配置"}},[s._v("#")]),s._v(" 选择 "),e("code",[s._v("gitee")]),s._v(" 进行配置")]),s._v(" "),e("p",[s._v("点击添加按钮，添加一个 "),e("code",[s._v("jenkins")]),s._v(" 权限\n"),e("img",{attrs:{src:a(493),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"添加-api-令牌"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加-api-令牌"}},[s._v("#")]),s._v(" 添加 API 令牌")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://gitee.com/profile/personal_access_tokens",target:"_blank",rel:"noopener noreferrer"}},[s._v("私人令牌获取地址"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("img",{attrs:{src:a(494),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"测试连接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试连接"}},[s._v("#")]),s._v(" 测试连接")]),s._v(" "),e("p",[s._v("如果失败请向上继续重新设置")]),s._v(" "),e("p",[e("img",{attrs:{src:a(495),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"设置-jenkins-位置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置-jenkins-位置"}},[s._v("#")]),s._v(" 设置 "),e("code",[s._v("jenkins")]),s._v(" 位置")]),s._v(" "),e("p",[e("img",{attrs:{src:a(496),alt:"Jenkins"}})]),s._v(" "),e("p",[s._v("设置完成！")]),s._v(" "),e("h2",{attrs:{id:"新建并配置构建任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新建并配置构建任务"}},[s._v("#")]),s._v(" 新建并配置构建任务")]),s._v(" "),e("h3",{attrs:{id:"点击新建任务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#点击新建任务"}},[s._v("#")]),s._v(" 点击新建任务")]),s._v(" "),e("p",[e("img",{attrs:{src:a(497),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"选择自由风格"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#选择自由风格"}},[s._v("#")]),s._v(" 选择自由风格")]),s._v(" "),e("p",[e("img",{attrs:{src:a(498),alt:"Jenkins"}})]),s._v(" "),e("h3",{attrs:{id:"源码管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码管理"}},[s._v("#")]),s._v(" 源码管理")]),s._v(" "),e("p",[e("img",{attrs:{src:a(499),alt:"Jenkins"}})]),s._v(" "),e("ol",[e("li",[e("code",[s._v("Repository URL")]),s._v(" 填写仓库地址")]),s._v(" "),e("li",[e("code",[s._v("Credentials")]),s._v(" 添加你的码云账户")]),s._v(" "),e("li",[e("code",[s._v("Name")]),s._v(" 填写 "),e("code",[s._v("origin")])]),s._v(" "),e("li",[e("code",[s._v("Refspec")]),s._v(" 填写 "),e("code",[s._v("+refs/heads/*:refs/remotes/origin/* +refs/pull/*/MERGE:refs/pull/*/MERGE")])]),s._v(" "),e("li",[e("code",[s._v("Branch Specifier (blank for 'any')")]),s._v(" 填写你要部署的分支")])]),s._v(" "),e("h3",{attrs:{id:"构建触发器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建触发器"}},[s._v("#")]),s._v(" 构建触发器")]),s._v(" "),e("p",[s._v("根据项目的情况自行填写。。。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(500),alt:"Jenkins"}})]),s._v(" "),e("h2",{attrs:{id:"配置-webhooks"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-webhooks"}},[s._v("#")]),s._v(" 配置 WebHooks")]),s._v(" "),e("ul",[e("li",[s._v("以 "),e("code",[s._v("gitee")]),s._v(" 举例🌰，其他托管平台也是可以的，例如 "),e("code",[s._v("gitlab")]),s._v(" "),e("code",[s._v("github")]),s._v(" 等")]),s._v(" "),e("li",[s._v("然后去你的远程仓库找到如下所示位置\n"),e("img",{attrs:{src:a(501),alt:"WebHooks"}})]),s._v(" "),e("li",[s._v("然后点击“添加”按钮，添加一个 webhooks 地址（就是你服务器的 post 请求地址）\n"),e("img",{attrs:{src:a(446),alt:"WebHooks"}})]),s._v(" "),e("li",[s._v("添加成功后可以进行测试，返回的信息自己参考一下是否正确\n"),e("img",{attrs:{src:a(446),alt:"WebHooks"}})])]),s._v(" "),e("p",[s._v("以上所有内容都已经配置好咯，以后就靠你推代码就可以实现自动部署了哦，不需要去服务器在来回手动去操作啦！")])])}),[],!1,null,null,null);t.default=n.exports}}]);